# schedule-proxy-exporter

## О приложении

Данное приложение нацелено на экспорт пар и занятий из РУЗ'а в Opencast

## Начало работы
### Настройка приложения

Для функционирования необходимо внести изменения в следующие файлы в папке OpencastAPI:

- [ПРИ НЕОБХОДИМОСТИ] acl.json - укажите актуальные права для доступа к событиям
- [ОБЯЗАТЕЛЬНО] mapping.json - укажите целевые аудитории, занятия из которых будут обрабатываться приложением
- [ПРИ НЕОБХОДИМОСТИ] metadata.json - укажите умолчательные значения для целевых метаданных
- [ПРИ НЕОБХОДИМОСТИ] processing.json - укажите умолчательные значения для метода обработки записи
- [ПРИ НЕОБХОДИМОСТИ] schedulling.json - укажите умолчательные значения для способа планирования и выгрузки
- [ПРИ НЕОБХОДИМОСТИ] series_acl.json - укажите актуальные права для доступа к сериям
- [ПРИ НЕОБХОДИМОСТИ] metadata.json - укажите умолчательные значения для целевых метаданных серий

### .env-файл

    Для корректной работы приложения необходимо создать и заполнить .env-файл (положить в директорию OpencastAPI) по следующей схеме:
    - OPENCAST_API_URL= ссылка на Opencast
    - OPENCAST_API_USER= логин для приложения
    - OPENCAST_API_PASSWORD= пароль для приложения
    - OPENCAST_API_ROLE= роль для приложения
    - OPENCAST_WORKFLOW_ID= schedule-and-upload (способ постинга событий в Opencast, желательно не менять значение)
    - SCHEDULE_API_URL= ссылка для доступа к schedule-api-proxy
    - EVENT_BEGIN_OFFSET_SECONDS=-240 (5-минутный отступ до начала пары во избежания коллизий)
    - EVENT_END_OFFSET_SECONDS= 900 (15-минутный отступ от конца пары во избежания коллизий)
    - AUTHORIZATION= токен для доступа к schedule-api-proxy

### Развёртывание приложения и установка зависимостей

Для использования приложения необходимо загрузить его? затем развернуть приложение, создав виртуальное окружение и установив зависимости:

- git clone https://git.miem.hse.ru/19102/schedule-proxy-exporter-release.git
- python -m venv venv && source venv/Scripts/activate
- pip install -r requirements.txt

Готово! Приложение готово к запуску.

## Запуск приложения и принцип его работы

Для запуска приложения необходимо использовать следующую консольную команду:

```
python exporting_script.py
```
Поздравляем, Вы великолепны. Программа начала свою работу и её ничто не остановит...  кроме Вас?

### Принцип работы приложения

- Суть:
   1) Приложение получает информацию о занятиях из базы данных (далее - БД)
   2) Приложение сортирует и находит занятия, которые:
        а) Актуальны (т.е. - датируются сегодняшним днём)
        б) Проходят в заранее указанных аудиториях (см. пункт "Начало работы" - "Настройка приложения")
   3) Данная информация встраивается в шаблон метаданных, которые отсылаются в Opencast. Вуаля! Событие теперь отображается в Opencast.
   3.1) Приложение также находит/создаёт серию, в которую включает новоиспечённое событие
   4) Итерация заканчивается, скрипт ожидает следующей итерации

## Расписание

    В данной версии выставлено умолчательное расписания активации скрипта:
    - 09:25
    - 11:05
    - 12:45
    - 12:55
    - 14:35
    - 16:15
    - 17:55
    - 18:05
    - 20:00

    То есть скрипт активируется за 5 минут до начала пары и через 15 минут после её окончания
